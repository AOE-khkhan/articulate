{"version":3,"sources":["../server/manifest.js"],"names":["Dotenv","config","path","__dirname","redisOptions","host","process","env","REDIS_HOST","port","REDIS_PORT","retry","INIT_RETRY","retryTimeout","INIT_RETRY_TIMEOUT","prefix","REDIS_PREFIX","Package","name","module","exports","Confidence","Store","server","HOST","PORT","routes","cors","validate","failAction","request","h","err","NODE_ENV","console","error","message","Boom","badRequest","debug","$filter","development","log","register","plugins","plugin","Schmervice","options","Nes","baseURL","RASA_URL","DUCKLING_URL","ES_HOST","ES_LOG","$default","production","Toys","noop","info","title","version","contact","documentationPage","schemes","SWAGGER_SCHEMES","SWAGGER_HOST","basePath","SWAGGER_BASE_PATH"],"mappings":"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","sourcesContent":["import Boom from 'boom';\nimport Confidence from 'confidence';\nimport Dotenv from 'dotenv';\nimport Nes from 'nes';\nimport Schmervice from 'schmervice';\nimport Toys from 'toys';\nimport Package from '../package.json';\n\n// Pull .env into process.env\nDotenv.config({ path: `${__dirname}/.env` });\nconst redisOptions = {\n    host: process.env.REDIS_HOST || 'redis',\n    port: process.env.REDIS_PORT || 6379,\n    retry: process.env.INIT_RETRY || 10,\n    retryTimeout: process.env.INIT_RETRY_TIMEOUT || 15000,\n    prefix: process.env.REDIS_PREFIX || Package.name\n};\n\n// Glue manifest as a confidence store\nmodule.exports = new Confidence.Store({\n    server: {\n        host: process.env.HOST || '0.0.0.0',\n        port: process.env.PORT || 7500,\n        routes: {\n            cors: true,\n            validate: {\n                failAction: (request, h, err) => {\n\n                    if (process.env.NODE_ENV === 'production') {\n                        // In prod, log a limited error message and throw the default Bad Request error.\n                        console.error('ValidationError:', err.message);\n                        throw Boom.badRequest(`Invalid request payload input`);\n                    }\n                    else {\n                        // During development, log and respond with the full error.\n                        console.error(err);\n                        throw err;\n                    }\n                }\n            }\n        },\n        debug: {\n            $filter: 'NODE_ENV',\n            development: {\n                log: ['error', 'implementation', 'internal'],\n                request: ['error', 'implementation', 'internal']\n            }\n        }\n    },\n    register: {\n        plugins: [\n\n            {\n                plugin: Schmervice,\n                options: {}\n            },\n            {\n                plugin: Nes,\n                options: {}\n            },\n            {\n\n                plugin: './plugins/rasa-nlu',\n                options: { //options passed to axios\n                    baseURL: process.env.RASA_URL || 'http://rasa:5000'\n                }\n            },\n            {\n\n                plugin: './plugins/duckling',\n                options: { //options passed to axios\n                    baseURL: process.env.DUCKLING_URL || 'http://localhost:8000'\n                }\n            },\n            {\n                plugin: './plugins/redis',\n                options: redisOptions\n            },\n            {\n                plugin: './plugins/es',\n                options: {\n                    host: process.env.ES_HOST || 'http://elasticsearch:9200',\n                    log: process.env.ES_LOG || 'error'\n                }\n            },\n            {\n                plugin: './plugins/redis-messaging',\n                options: redisOptions\n            },\n            {\n\n                plugin: './plugins/handlebars',\n                options: {}\n            },\n            {\n                plugin: {\n                    $filter: 'NODE_ENV',\n                    $default: 'hpal-debug',\n                    production: Toys.noop\n                }\n            },\n            {\n                plugin: './plugins/swagger',\n                options: {\n                    info: {\n                        title: 'Articulate API Documentation',\n                        version: Package.version,\n                        contact: {\n                            name: 'Smart Platform Group'\n                        }\n                    },\n                    documentationPage: false,\n                    schemes: process.env.SWAGGER_SCHEMES || null,\n                    host: process.env.SWAGGER_HOST || null,\n                    basePath: process.env.SWAGGER_BASE_PATH || null\n                }\n            },\n            {\n                plugin: './lib', // Main plugin\n                options: {}\n            }\n        ]\n    }\n});\n"],"file":"manifest.js"}