{"version":3,"sources":["../../../server/lib/init/default-settings.init.js"],"names":["module","exports","server","redis","app","services","settingsService","contextService","CurrentSettings","findAll","Promise","all","_","map","defaultSettings","value","name","create","data","Model","factory","MODEL_CONTEXT","sessionId","defaultUISessionId","findBySessionId","inDb"],"mappings":";;AAAA;;AACA;;AACA;;;;AAEAA,MAAM,CAACC,OAAP,GAAiB,MAAOC,MAAP,IAAkB;AAAA,QAEvBC,KAFuB,GAEbD,MAAM,CAACE,GAFM,CAEvBD,KAFuB;;AAAA,eAGa,MAAMD,MAAM,CAACG,QAAP,EAHnB;AAAA,QAGvBC,eAHuB,QAGvBA,eAHuB;AAAA,QAGNC,cAHM,QAGNA,cAHM;;AAI/B,QAAMC,eAAe,GAAG,MAAMF,eAAe,CAACG,OAAhB,EAA9B;AAEA,QAAMC,OAAO,CAACC,GAAR,CAAYC,gBAAEC,GAAF,CAAMC,wBAAN,EAAuB,OAAOC,KAAP,EAAcC,IAAd,KAAuB;AAE5D,QAAIR,eAAe,CAACQ,IAAD,CAAnB,EAA2B;AACvB;AACH;;AACD,WAAO,MAAMV,eAAe,CAACW,MAAhB,CAAuB;AAAEC,MAAAA,IAAI,EAAE;AAAEF,QAAAA,IAAF;AAAQD,QAAAA;AAAR;AAAR,KAAvB,CAAb;AACH,GANiB,CAAZ,CAAN;AAQA,QAAMI,KAAK,GAAG,MAAMhB,KAAK,CAACiB,OAAN,CAAcC,wBAAd,CAApB;AACA,QAAMC,SAAS,GAAGR,yBAAgBS,kBAAlC;AACA,QAAMJ,KAAK,CAACK,eAAN,CAAsB;AAAEF,IAAAA;AAAF,GAAtB,CAAN;;AAEA,MAAI,CAACH,KAAK,CAACM,IAAX,EAAiB;AACb,UAAMlB,cAAc,CAACU,MAAf,CAAsB;AAAEC,MAAAA,IAAI,EAAE;AAAEI,QAAAA;AAAF;AAAR,KAAtB,CAAN;AACH;AACJ,CArBD","sourcesContent":["import _ from 'lodash';\nimport defaultSettings from '../../util/default-settings';\nimport { MODEL_CONTEXT } from '../../util/constants';\n\nmodule.exports = async (server) => {\n\n    const { redis } = server.app;\n    const { settingsService, contextService } = await server.services();\n    const CurrentSettings = await settingsService.findAll();\n\n    await Promise.all(_.map(defaultSettings, async (value, name) => {\n\n        if (CurrentSettings[name]) {\n            return;\n        }\n        return await settingsService.create({ data: { name, value } });\n    }));\n\n    const Model = await redis.factory(MODEL_CONTEXT);\n    const sessionId = defaultSettings.defaultUISessionId;\n    await Model.findBySessionId({ sessionId });\n\n    if (!Model.inDb) {\n        await contextService.create({ data: { sessionId } });\n    }\n};\n"],"file":"default-settings.init.js"}