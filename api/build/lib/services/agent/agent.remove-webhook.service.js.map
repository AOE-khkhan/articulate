{"version":3,"sources":["../../../../server/lib/services/agent/agent.remove-webhook.service.js"],"names":["module","exports","id","redis","server","app","services","globalService","WebhookModel","factory","MODEL_WEBHOOK","agent","findById","model","MODEL_AGENT","returnModel","ids","getAll","Promise","all","map","currentId","removeInstance","error"],"mappings":";;AAAA;;AAIA;;;;AAEAA,MAAM,CAACC,OAAP,GAAiB,gBAAgB;AAAEC,EAAAA;AAAF,CAAhB,EAAwB;AAAA,QAE7BC,KAF6B,GAEnB,KAAKC,MAAL,CAAYC,GAFO,CAE7BF,KAF6B;;AAAA,eAGX,MAAM,KAAKC,MAAL,CAAYE,QAAZ,EAHK;AAAA,QAG7BC,aAH6B,QAG7BA,aAH6B;;AAIrC,QAAMC,YAAY,GAAG,MAAML,KAAK,CAACM,OAAN,CAAcC,wBAAd,CAA3B;;AACA,MAAI;AAEA,UAAMC,KAAK,GAAG,MAAMJ,aAAa,CAACK,QAAd,CAAuB;AAAEV,MAAAA,EAAF;AAAMW,MAAAA,KAAK,EAAEC,sBAAb;AAA0BC,MAAAA,WAAW,EAAE;AAAvC,KAAvB,CAApB;AACA,UAAMC,GAAG,GAAG,MAAML,KAAK,CAACM,MAAN,CAAaP,wBAAb,EAA4BA,wBAA5B,CAAlB;AAEA,UAAMQ,OAAO,CAACC,GAAR,CAAYH,GAAG,CAACI,GAAJ,CAAQ,MAAOC,SAAP,IAAqB;AAE3C,aAAO,MAAMb,YAAY,CAACc,cAAb,CAA4B;AAAEpB,QAAAA,EAAE,EAAEmB;AAAN,OAA5B,CAAb;AACH,KAHiB,CAAZ,CAAN;AAIH,GATD,CAUA,OAAOE,KAAP,EAAc;AACV,UAAM,oBAAkB;AAAEA,MAAAA;AAAF,KAAlB,CAAN;AACH;AACJ,CAlBD","sourcesContent":["import {\n    MODEL_AGENT,\n    MODEL_WEBHOOK\n} from '../../../util/constants';\nimport RedisErrorHandler from '../../errors/redis.error-handler';\n\nmodule.exports = async function ({ id }) {\n\n    const { redis } = this.server.app;\n    const { globalService } = await this.server.services();\n    const WebhookModel = await redis.factory(MODEL_WEBHOOK);\n    try {\n\n        const agent = await globalService.findById({ id, model: MODEL_AGENT, returnModel: true });\n        const ids = await agent.getAll(MODEL_WEBHOOK, MODEL_WEBHOOK);\n\n        await Promise.all(ids.map(async (currentId) => {\n\n            return await WebhookModel.removeInstance({ id: currentId });\n        }));\n    }\n    catch (error) {\n        throw RedisErrorHandler({ error });\n    }\n};\n"],"file":"agent.remove-webhook.service.js"}