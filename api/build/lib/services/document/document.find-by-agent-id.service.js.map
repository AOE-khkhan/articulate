{"version":3,"sources":["../../../../server/lib/services/document/document.find-by-agent-id.service.js"],"names":["module","exports","agentId","direction","SORT_DESC","skip","limit","field","es","server","app","DocumentModel","models","MODEL_DOCUMENT","body","toLowerCase","results","search","hits","total","data","totalCount","map","result","id","_id","_source","error"],"mappings":";;AAAA;;AACA;;AACA;;AAIA;;;;;;;;AAEAA,MAAM,CAACC,OAAP,GAAiB,gBAAgB;AAAEC,EAAAA,OAAF;AAAWC,EAAAA,SAAS,GAAGC,oBAAvB;AAAkCC,EAAAA,IAAI,GAAG,CAAzC;AAA4CC,EAAAA,KAAK,GAAG,EAApD;AAAwDC,EAAAA,KAAK,GAAG;AAAhE,CAAhB,EAAgG;AAAA,QAErGC,EAFqG,GAE9F,KAAKC,MAAL,CAAYC,GAFkF,CAErGF,EAFqG;AAG7G,QAAMG,aAAa,GAAGH,EAAE,CAACI,MAAH,CAAUC,yBAAV,CAAtB;;AACA,MAAI;AACA,UAAMC,IAAI,GAAG;AACT,cAAQT,IADC;AAET,cAAQC,KAFC;AAGT,cAAQ,CACJ;AACI,SAACC,KAAD,GAAS;AACL,mBAASJ,SAAS,CAACY,WAAV,EADJ;AAEL,qBAAW;AAFN;AADb,OADI,CAHC;AAWT,eAAS;AACL,iBAAS;AACL,sBAAYb;AADP;AADJ;AAXA,KAAb;AAkBA,UAAMc,OAAO,GAAG,MAAML,aAAa,CAACM,MAAd,CAAqB;AAAEH,MAAAA;AAAF,KAArB,CAAtB;;AACA,QAAIE,OAAO,CAACE,IAAR,CAAaC,KAAb,KAAuB,CAA3B,EAA8B;AAC1B,aAAO;AAAEC,QAAAA,IAAI,EAAE,EAAR;AAAYC,QAAAA,UAAU,EAAE;AAAxB,OAAP;AACH;;AACD,UAAMD,IAAI,GAAGJ,OAAO,CAACE,IAAR,CAAaA,IAAb,CAAkBI,GAAlB,CAAuBC,MAAD;AAAeC,MAAAA,EAAE,EAAED,MAAM,CAACE;AAA1B,OAAkCF,MAAM,CAACG,OAAzC,CAAtB,CAAb;AAEA,WAAO;AAAEN,MAAAA,IAAF;AAAQC,MAAAA,UAAU,EAAEL,OAAO,CAACE,IAAR,CAAaC;AAAjC,KAAP;AACH,GA1BD,CA2BA,OAAOQ,KAAP,EAAc;AACV,UAAM,iBAAe;AAAEA,MAAAA;AAAF,KAAf,CAAN;AACH;AACJ,CAlCD","sourcesContent":["import _ from 'lodash';\nimport util from 'util';\nimport {\n    MODEL_DOCUMENT,\n    SORT_DESC\n} from '../../../util/constants';\nimport ESErrorHandler from '../../errors/es.error-handler';\n\nmodule.exports = async function ({ agentId, direction = SORT_DESC, skip = 0, limit = 50, field = 'time_stamp' }) {\n\n    const { es } = this.server.app;\n    const DocumentModel = es.models[MODEL_DOCUMENT];\n    try {\n        const body = {\n            'from': skip,\n            'size': limit,\n            'sort': [\n                {\n                    [field]: {\n                        'order': direction.toLowerCase(),\n                        'missing': 0\n                    }\n                }\n            ],\n            'query': {\n                'match': {\n                    'agent_id': agentId\n                }\n            }\n        };\n\n        const results = await DocumentModel.search({ body });\n        if (results.hits.total === 0) {\n            return { data: [], totalCount: 0 };\n        }\n        const data = results.hits.hits.map((result) => ({ id: result._id, ...result._source }));\n\n        return { data, totalCount: results.hits.total };\n    }\n    catch (error) {\n        throw ESErrorHandler({ error });\n    }\n};\n"],"file":"document.find-by-agent-id.service.js"}