{"version":3,"sources":["../../../../server/lib/services/document/document.create.service.js"],"names":["module","exports","data","es","server","app","services","documentService","DocumentModel","models","MODEL_DOCUMENT","result","createInstance","id","_id","agentDocuments","findByAgentId","agentId","agent_id","publish","ROUTE_AGENT","ROUTE_DOCUMENT","error"],"mappings":";;AAAA;;AACA;;;;AAEAA,MAAM,CAACC,OAAP,GAAiB,gBAAgB;AAAEC,EAAAA;AAAF,CAAhB,EAA0B;AAAA,QAE/BC,EAF+B,GAExB,KAAKC,MAAL,CAAYC,GAFY,CAE/BF,EAF+B;;AAAA,eAGX,MAAM,KAAKC,MAAL,CAAYE,QAAZ,EAHK;AAAA,QAG/BC,eAH+B,QAG/BA,eAH+B;;AAKvC,QAAMC,aAAa,GAAGL,EAAE,CAACM,MAAH,CAAUC,yBAAV,CAAtB;;AACA,MAAI;AAEA,UAAMC,MAAM,GAAG,MAAMH,aAAa,CAACI,cAAd,CAA6B;AAAEV,MAAAA;AAAF,KAA7B,CAArB;AACAA,IAAAA,IAAI,CAACW,EAAL,GAAUF,MAAM,CAACG,GAAjB;AACA,UAAMC,cAAc,GAAG,MAAMR,eAAe,CAACS,aAAhB,CAA8B;AAAEC,MAAAA,OAAO,EAAEf,IAAI,CAACgB;AAAhB,KAA9B,CAA7B;AACA,SAAKd,MAAL,CAAYe,OAAZ,CAAqB,IAAGC,sBAAY,IAAGlB,IAAI,CAACgB,QAAS,IAAGG,yBAAe,EAAvE,EAA0EN,cAA1E;AACA,WAAOb,IAAP;AACH,GAPD,CAQA,OAAOoB,KAAP,EAAc;AACV,UAAM,iBAAe;AAAEA,MAAAA;AAAF,KAAf,CAAN;AACH;AACJ,CAjBD","sourcesContent":["import { MODEL_DOCUMENT, ROUTE_DOCUMENT, ROUTE_AGENT } from '../../../util/constants';\nimport ESErrorHandler from '../../errors/es.error-handler';\n\nmodule.exports = async function ({ data }) {\n\n    const { es } = this.server.app;\n    const { documentService } = await this.server.services();\n\n    const DocumentModel = es.models[MODEL_DOCUMENT];\n    try {\n\n        const result = await DocumentModel.createInstance({ data });\n        data.id = result._id;\n        const agentDocuments = await documentService.findByAgentId({ agentId: data.agent_id });\n        this.server.publish(`/${ROUTE_AGENT}/${data.agent_id}/${ROUTE_DOCUMENT}`, agentDocuments);\n        return data;\n    }\n    catch (error) {\n        throw ESErrorHandler({ error });\n    }\n};\n"],"file":"document.create.service.js"}